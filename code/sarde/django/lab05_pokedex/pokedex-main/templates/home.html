<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pokedex</title>
</head>

<body>
    {% csrf_token %}

    {% if user.is_authenticated %}
    <h1>Welcome {{ user.username }}!</h1>
    <p><a href="{% url 'logout' %}">Logout</a>
    <p>
        {% else %}
    <h1>Welcome, visitor!</h1>
    <p>You are not logged in. <a href="{% url 'login' %}">Login</a> <a href="{% url 'users:signup' %}">Sign Up</a></p>
    {% endif %}

    <div id="app">
        <div>
            <label for="number">number</label>
            <input v-model="newPokemon.number" id="number" placeholder="number">
        </div>

        <p>[[ message ]]</p>
        <!-- <pre>[[ listOfPokemons ]]</pre> -->
        <ul>
            <li v-for="pokemon in listOfPokemons">
                [[ pokemon.name ]]
            </li>
        </ul>

        <button @click="addPokemon">Add</button>
    </div>

    <script src="https://unpkg.com/vue@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios@1.1.2/dist/axios.min.js"></script>

    <script>
        const app = new Vue({
            el: '#app',
            delimiters: ['[[', ']]'],
            data: {
                message: 'Pokedex',
                urlEndpoint: '/pokemon-api/',
                listOfPokemons: '',
                hardCodedPokemon: {
                    "number": 1,
                    "name": "bulbasaur",
                    "height": 0.7,
                    "weight": 6.9,
                    "image_front": "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/1.png",
                    "image_back": "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/back/1.png",
                },
                csrf_token: '',
                newPokemon: {
                    number: '',
                    name: '',
                    height: '',
                    weight: '',
                    image_front: '',
                    image_back: '',

                },
            },

            methods: {
                loadPokedex: function () {
                    console.log('loading pokemon')
                    axios({
                        method: 'get',
                        url: this.urlEndpoint,
                    }).then(response => {
                        // console.log(response.data)
                        this.listOfPokemons = response.data
                        console.log('listOfPokemons', this.listOfPokemons)

                    }).catch(error => {
                        console.log('error.response: ', error.response)
                        console.log('error.response.data: ', error.response.data)
                    })
                },
                addPokemon: function () {
                    console.log('adding pokemon')
                    axios({
                        method: 'post',
                        url: this.urlEndpoint,
                        data: this.hardCodedPokemon,
                        headers: {
                            "X-CSRFToken": this.csrf_token
                        },
                    }).then(response => {
                        console.log('response.data', response.data)
                        this.loadPokedex()
                    }).catch(error => {
                        console.log('error.response: ', error.response)
                        console.log('error.response.data: ', error.response.data)
                    })
                },

            },
            mounted: function () {
                console.log('mounting')
                this.loadPokedex()
                this.csrf_token = document.querySelector("input[name=csrfmiddlewaretoken]").value
            }






        });



    </script>
</body>

</html>